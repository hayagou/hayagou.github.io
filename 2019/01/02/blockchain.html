<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    블록체인, 비트코인 소스코드 분석 - Hayagou
    
  </title>

  <meta name="description" content="비트 코인 소스 분석">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://hayagou.github.io/2019/01/02/blockchain.html">
  <link rel="alternate" type="application/rss+xml" title="Hayagou" href="/feed.xml">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158054059-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-158054059-1');
  </script>

  <script data-ad-client="ca-pub-4295120214669813" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">Hayagou</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

<header class="masthead" style="background-image: url('/img/bg-post.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>블록체인, 비트코인 소스코드 분석</h1>
            
            <span class="meta">Posted by
              <a href="#">hayagou</a>
              on 2019-01-02 &middot; <span class="reading-time" title="Estimated read time">
  
   4 mins  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <h1 id="비트-코인-소스-분석">비트 코인 소스 분석</h1>
<hr />

<p>가상화폐중 비트코인에 대한 관심이 많다. 그레서 이번 프로젝트의 한부분으로 가상화폐를 이용하여 전자거 시스템을 만들려고 한다.
이번에 진행하는 프로젝트의 한부분인 블록체인 기술을 활용하여 가상화폐를 구현 해야한다.
구글에 검색하고 유튜브에 검색을 해도 자료가 많이 없어서 우선은 가장유명한 가상화폐인 비트코인 코드부터 분석을 하려고 한다. 오픈소스라 깃허브에 소스코드가 올라와있다.
비트코인의 소스를 분석하고 분석한것을 바탕으로 가상화폐를 구현할 것이다.</p>

<p>직접 구현을 하기전에 블록체인이라는 기술에 대하여 알아야할것 같아서 인터넷 검색을 통해 자료를 정리하였다.</p>

<p><br /></p>

<h2 id="가상화폐란">가상화폐란?</h2>
<hr />

<p>블록체인을 말로 풀어서 설명하면
<strong>거래기록등 여러 데이터들이 한 블록에 들어있고 그 블록들이 체인으로 이어져 있다</strong>
는 것이다. 이블록들은 변조를 시켜 부당한 이득을 취할수 없게 블록은 해쉬값을 가지고있다.</p>

<p>여기서 가장 큰 특징은 블록으로 이루어진 체인들을 가상화폐를 소유하고 있는 모든 사용자가 블록에 대한 정보를 가지고있다. 
<strong>데이터 분산 처리 기술</strong> 이 적용 되어 데이터가 변조된다고 해도 블록체인에 참여한 사용자 50%를 설득하지못하면 변조된 데이터를 폐기한다. 그렇게 때문에 변조가 거의 불가능하다.
이러한 특징때문에 중앙(은행)에서 거래 내역을 관리하는 기존화폐와는 달리 블록체인은 참여자들 모두 거래내역을 가지고있어 중앙 관리자가 필요가 없게된다.(분산저장)</p>

<p>블록체인 기술을 활용하여 비트코인을 만든 ‘나카모토 사토시’가 쓴 <a href="/assets/bitcoin-translated-korean-180105.pdf" download="">논문</a>을 읽어보면 좋을것 같다. 한글로 번역된 논문을 구했는데 읽어보니 어려워서 이해를 못했다….</p>

<p><br /></p>

<h2 id="비트코인-소스">비트코인 소스</h2>

<p><a href="https://github.com/bitcoin/bitcoin">비트코인 깃허브</a> 로 가면 C++로된 비트코인 소스를 받을수 있다.</p>

<p>나는 스프링 프레임워크로 웹을 만들어서 동작시킬 계획이라 똑같은 언어인 자바로 구현하는게 좋을것 같아서 <a href="https://github.com/bitcoinj/bitcoinj">자바로 구현된 비트코인 소스</a>를 분석할 생각이다.</p>

<p>압축을 풀어주면 코드들이 보인다.
<img src="/img/posts/block/coinj.png" alt="비트코인J" class="img-responsive center-block" /></p>

<p>풀어준 파일들을 IDE로 임폴트 시킨다.
임포트 시킬때 gradle이란 빌드시스템을 추가해야지 동작이된다.
스프링에 maven이랑 비슷한 빌드 시스템인데 라이브러리들을 관리하기 위한것으로 별도로 라이브러리들을 설치할필요없이 바로 빌드할수있게 해주는 시스템이다.</p>

<p><img src="/img/posts/block/coinj1.png" alt="비트코인J" class="img-responsive center-block" width="800" height="500" /></p>

<p>소스파일들을 열어보면 코드가 너무 어렵다… 주석을 보면서 실행시키면서 어떻게 돌아가는건지 분석을하고 정리해봐야 겠다</p>

<p><br /></p>

<h2 id="기본구조">기본구조</h2>
<hr />

<p><strong>bitcoinj 의 구조</strong></p>

<ul>
  <li>NetworkParameters : 네트워크를 선택하는 객체</li>
  <li>Wallet : ECKey와 다른 데이터들을 저장하는 객체</li>
  <li>PeerGroup : 네트워크연결을 관리하는 객체</li>
  <li>BlockChain : 비트코인이 동작하기 위해 공유되거나 전체적인 데이터 구조를 관리하는 객체</li>
  <li>BlockStore : 블록체인 데이터 구조를 유지하는 객체, ex) 디스크</li>
  <li>WalletEventListener : Wallet 이벤트를 받을수있게록한 구현</li>
</ul>

<p>이러한 객체들을 사용하여 각각 설정을 따로 해줄수 있다.
간단하게 설정을 하기 위해 WalletAppKit이라는 객체가 존재한다.</p>

<p>가장 먼저 WalletAppKit이라는 객체를 분석해보자</p>

<p>WalletAppKit이라는 객체의 위치로 가서 코드를 보자!</p>

<p><img src="/img/posts/block/coinj2.png" alt="비트코인J" class="img-responsive center-block" /></p>

<p>가장 먼저 생성자를 본다.</p>
<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div><div style="line-height:130%">17</div><div style="line-height:130%">18</div><div style="line-height:130%">19</div><div style="line-height:130%">20</div><div style="line-height:130%">21</div><div style="line-height:130%">22</div><div style="line-height:130%">23</div><div style="line-height:130%">24</div><div style="line-height:130%">25</div><div style="line-height:130%">26</div><div style="line-height:130%">27</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;<span style="color:#999999">/**</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;WalletAppKit,&nbsp;with&nbsp;a&nbsp;newly&nbsp;created&nbsp;{@link&nbsp;Context}.&nbsp;Files&nbsp;will&nbsp;be&nbsp;stored&nbsp;in&nbsp;the&nbsp;given&nbsp;directory.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;WalletAppKit(NetworkParameters&nbsp;params,&nbsp;File&nbsp;directory,&nbsp;<span style="color:#066de2">String</span>&nbsp;filePrefix)&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>(<span style="color:#a71d5d">new</span>&nbsp;Context(params),&nbsp;Script.ScriptType.P2PKH,&nbsp;<span style="color:#066de2">null</span>,&nbsp;directory,&nbsp;filePrefix);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">/**</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;WalletAppKit,&nbsp;with&nbsp;a&nbsp;newly&nbsp;created&nbsp;{@link&nbsp;Context}.&nbsp;Files&nbsp;will&nbsp;be&nbsp;stored&nbsp;in&nbsp;the&nbsp;given&nbsp;directory.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;WalletAppKit(NetworkParameters&nbsp;params,&nbsp;Script.ScriptType&nbsp;preferredOutputScriptType,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Nullable&nbsp;KeyChainGroupStructure&nbsp;structure,&nbsp;File&nbsp;directory,&nbsp;<span style="color:#066de2">String</span>&nbsp;filePrefix)&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>(<span style="color:#a71d5d">new</span>&nbsp;Context(params),&nbsp;preferredOutputScriptType,&nbsp;structure,&nbsp;directory,&nbsp;filePrefix);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">/**</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;Creates&nbsp;a&nbsp;new&nbsp;WalletAppKit,&nbsp;with&nbsp;the&nbsp;given&nbsp;{@link&nbsp;Context}.&nbsp;Files&nbsp;will&nbsp;be&nbsp;stored&nbsp;in&nbsp;the&nbsp;given&nbsp;directory.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#999999">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">public</span>&nbsp;WalletAppKit(Context&nbsp;context,&nbsp;Script.ScriptType&nbsp;preferredOutputScriptType,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@Nullable&nbsp;KeyChainGroupStructure&nbsp;structure,&nbsp;File&nbsp;directory,&nbsp;<span style="color:#066de2">String</span>&nbsp;filePrefix)&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>.context&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;context;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>.params&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;checkNotNull(context.getParams());</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>.preferredOutputScriptType&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;checkNotNull(preferredOutputScriptType);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>.structure&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;structure&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">!</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#066de2">null</span>&nbsp;?&nbsp;structure&nbsp;:&nbsp;KeyChainGroupStructure.DEFAULT;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>.directory&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;checkNotNull(directory);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">this</span>.filePrefix&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;checkNotNull(filePrefix);</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"></div></td></tr></table></div>

<p>주석을 읽어보면 새로운 WalletAppKit 객체를 만들고 지정된 경로에 파일을 생성한다고한다… 생성자를 봐도 뭔지 잘모르겟다.</p>

<p>다행 사용하는 예시가 있었다…
<img src="/img/posts/block/coinj3.png" alt="비트코인J" class="img-responsive center-block" width="800" /></p>

<p>첫번째로 해야할 일이 네트워크 설정이다.
NetworkParameters 라는 객체를 사용하여 네트워크 설정을 한다. 설정을 하기위한 옵션은 3개가 있다.</p>
<ul>
  <li>MainNetParams : 설명은 안적혀있지만 눈치껏 실제 서비스를 하기위한 네트워크 설정인것 같다.</li>
  <li>TestNet3Params : 실제 네트워크에서 테스트하기위한 설정, MainNet과 같은 규칙을 따른다</li>
  <li>RegTestParams : 개발하는동안 로컬 네트워크에서 테스팅을위한 설정</li>
</ul>

<p>우선 예제를 바로 실행시켜보았다. 좀 결과를 보는데 조금 오래 걸리지만 실행이 되었다.
<img src="/img/posts/block/coinj4.png" alt="비트코인J" class="img-responsive center-block" /></p>



        <hr>

        
        <div id="disqus_thread"></div>
        <script>
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = 'https://hayagou-github-io.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
        <hr>
        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/2017/01/16/command.html" data-toggle="tooltip" data-placement="top" title="Command Pattern">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          

        </div>

      </div>
    </div>
  </div>


  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:de0978@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/hayagou">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; hayagou 2020</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-158054059-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-158054059-1');
</script>



</body>

</html>
